const spaceIt=(()=>{let e=null,t="w3spaces",a="https://tryit-api.w3schools.com/tryit";const n="https://profile.w3schools.com",o=encodeURIComponent(`https://${location.host+location.pathname+location.search}`),s=e=>{let t=document.getElementById("spaceItModalContainer");t.innerHTML="";let a=`\n      <div id="spaceItLoadingContainer">\n        <h1 class="spaceit-loader-text">Please wait...</h1>\n        <div id="spaceItLoader" class="spaceit-loader-container">\n          <img class="spaceit-loader" src="/images/spinner.svg">\n        </div>\n        <p class="spaceit-loader-text">${e}</p>\n      </div>\n    `;t.insertAdjacentHTML("beforeend",a)},c=()=>{let e=document.getElementById("spaceItModalContainer");e.innerHTML="";e.insertAdjacentHTML("beforeend",'\n      <div id="spaceItRegisterContainer">\n        <h1>Create a space</h1>\n        <p>To save code snippets you need a space first. What do you want to call this space?</p>\n        <div class="w3-margin-bottom">\n          <br>\n          <form>\n            <div class="spaceit-modal-input-group w3-margin-bottom">\n              <input id="spaceItSpaceName" class="spaceit-modal-input" required placeholder="Enter a name for your space" minlength="4" maxlength="20"> \n              <div class="spaceit-modal-input-group-append"><span class="spaceit-modal-input-group-text">.w3spaces.com</span></div>\n            </div>\n            <small class="spaceit-modal-input-validation-error"><div id="spaceit-modal-input-group--validation-error"></div></small>\n          </form>\n          <p>This will also be the public url for your space.</p>\n        </div>\n        <div class="spaceit-modal-button-bar">\n          <a href="javascript:void(0);" id="spaceItCancelButton" class="spaceit-modal-button-secondary" onclick="spaceIt.closeDialog();">Cancel</a>\n          <a href="javascript:void(0);" id="spaceItRegisterButton" class="spaceit-modal-button-primary" onclick="spaceIt.registerSpace(document.getElementById(\'spaceItSpaceName\').value);">Create a space</a>\n        </div>\n\n      </div>\n    ')},i=()=>{let t=document.getElementById("spaceItModalContainer");t.innerHTML="";let a=`\n      <div id="spaceItSaveContainer">\n        <h1>${e.data.spaces.length,"Save your code to W3Schools Spaces?"}</h1>\n        <div class="spaceit-modal-margin-top w3-margin-bottom">\n          Your space\n          <select id="spaceItSelectedSpace" class="minimal w3-margin-bottom" style="margin-bottom: 10px;"></select>\n          Name your file\n          <br>\n          <div class="spaceit-modal-input-group w3-margin-bottom">\n            <input id="spaceItSelectedFilename" class="spaceit-modal-input" onkeyup="spaceIt.checkFilename()" required maxlength="40"> \n            <div class="spaceit-modal-input-group-append"><span class="spaceit-modal-input-group-text">.html</span></div>\n          </div>\n          <small class="spaceit-modal-input-validation-error"><div id="spaceit-modal-input-group-error"></div></small>\n        </div>\n        <div class="spaceit-modal-button-bar">\n          <a href="javascript:void(0);" id="spaceItCancelButton" class="spaceit-modal-button-secondary" onclick="spaceIt.closeDialog();">Cancel</a>\n          <a href="javascript:void(0);" id="spaceItSaveButton" class="spaceit-modal-button-primary" onclick="spaceIt.saveCode();">Save code snippet</a>\n        </div>\n      </div>\n    `;t.insertAdjacentHTML("beforeend",a),document.getElementById("spaceItSelectedSpace").innerText=null,e.data.spaces.sort(((e,t)=>e.localeCompare(t)));for(let t of e.data.spaces){let e=document.createElement("option");e.value=t,e.innerHTML=t,document.getElementById("spaceItSelectedSpace").appendChild(e)}},d=(e,a)=>{let n=document.getElementById("spaceItModalContainer");n.innerHTML="";let o=`\n      <div id="spaceItSaveSuccessContainer">\n        <div class="spaceit-modal-success-button">\n          <img class="spaceit-modal-success-img" src="/images/spaceit_success.svg">\n        </div>\n        <h1 class="spaceit-modal-success-header">Code snippet saved!</h1>\n        <p class="spaceit-modal-success-text" style="text-align:center">You will find this code snippet at<br><a style="color: #282A35" href="https://${e}.${t}.com/${a}" target="_blank"><b>https://${e}.${t}.com/${a}</b></a></p>\n        <div class="spaceit-modal-success-button">\n          <a href="https://spaces.w3schools.com/space/${e}" target="_blank" id="spaceItViewButton" class="spaceit-modal-button-secondary">View file in Spaces<img class="spaceit-success-button-icon" src="/images/export.svg"></a>\n        </div>\n        <div class="tooltip spaceit-modal-success-button">\n          <br>\n        </div>\n      </div>\n    `;n.insertAdjacentHTML("beforeend",o)},r=async()=>{if(window.editor&&window.editor.save(),!document.getElementById("textareaCode").value.length)return;if(!document.getElementById("spaceItModal")){let e='\n          <div id="spaceItModal" class="w3-modal">\n            <div id="spaceItModalParentContainer" class="w3-modal-content spaceit-modal">\n              <div id="spaceItModalCloseButton" class="spaceit-modal-close-button">\n                <a href="javascript:void(0);" onclick="spaceIt.closeDialog();"><img src="/images/close-icon-tryit.svg"></img></a>\n              </div>\n              <div id="spaceItModalContainer" class="spaceit-modal-container"></div>\n            </div>\n          </div>\n        ';document.querySelector("body").insertAdjacentHTML("beforeend",e)}document.getElementById("spaceItModal").style.display="block",document.getElementById("spaceItModal").addEventListener("mousedown",n),document.getElementById("spaceItModal").addEventListener("mouseup",o),document.getElementById("spaceItModal").addEventListener("touchstart",n),document.getElementById("spaceItModal").addEventListener("touchend",o);var t=!1;function n(e){t="spaceItModal"==e.target.id}function o(e){"spaceItModal"==e.target.id&&t&&spaceIt.closeDialog()}s("We are loading your information...");if(await(async()=>new Promise((e=>{UserSession.processUserSession((function(t){e("0"===t.error.code)}),!1)})))()){if(await(async()=>{e=await fetch(a+"/user",{method:"GET",headers:{Authorization:`Bearer ${Cookies.get("accessToken")}`},credentials:"include"}).then((e=>e.json()))})(),void 0===e.error||void 0===e.error.code||"0"!==e.error.code)return void(()=>{let e=document.getElementById("spaceItModalContainer");e.innerHTML="",e.insertAdjacentHTML("beforeend",'\n      <div id="spaceItErrorContainer">\n        <h1 class="spaceit-modal-success-header">Something bad happened!</h1>\n        <p class="spaceit-modal-success-text">An error occured while processing your request.</p>\n        <p class="spaceit-modal-success-text">If the problem persists please contact support.</p>\n      </div>\n    ')})();e.data.spaces&&e.data.spaces.length?(i(),document.getElementById("spaceItSelectedFilename").value=`saved-from-Tryit-${(new Date).toJSON().split("T")[0]}`):e.data.out_of_quota?(()=>{let e=document.getElementById("spaceItModalContainer");e.innerHTML="",e.insertAdjacentHTML("beforeend",'\n      <div id="spaceItSaveSuccessContainer">\n        <h1 class="spaceit-modal-success-header">You are out of quota!</h1>\n        <p class="spaceit-modal-success-text">Your space got closed temporarily, since you already used this month\'s included quota. Your space will be opened again when your next subscription period starts.</p>\n        <p class="spaceit-modal-success-text">Want more quota - and get your space opened right away? Then upgrade to a bigger plan that includes more quota.</p>\n        <div class="spaceit-modal-success-button">\n          <a href="https://billing.w3schools.com" target="_blank" id="spaceItViewButton" class="spaceit-modal-button-secondary">Upgrade to a bigger plan</a>\n        </div>\n      </div>\n    ')})():c()}else window.editor&&window.editor.save(),document.getElementById("textareaCode").value.length&&window.localStorage.setItem("spaceItCode",document.getElementById("textareaCode").value),(()=>{let e=document.getElementById("spaceItModalContainer");e.innerHTML="",e.insertAdjacentHTML("beforeend",'\n      <div id="spaceItLoginContainer">\n        <div class="spaceit-modal-login-image-container">\n          <img class="spaceit-modal-login-image" src="/images/illustration.png">\n        </div>\n        <div class="spaceit-modal-login-header">\n          <img src="/images/new-label.svg">\n          <h1>Save your code to<br class="w3-hide-large w3-hide-medium"> W3Schools Spaces</h1>\n        </div>\n        <div>\n        <p>Log in or sign up for free to save your code now.</p>\n        <p class="w3-hide-small">Spaces is a personal place where you can create your own web pages; save your code and share it with others.\n        <div class="spaceit-modal-button-bar">\n          <a href="javascript:void(0);" id="spaceItLoginButton" class="spaceit-modal-button-secondary" onclick="spaceIt.login()">Log in</a>  \n          <a href="javascript:void(0);" id="spaceItSignButton" class="spaceit-modal-button-primary" onclick="spaceIt.signup()">Sign up for free</a>\n        </div>\n      </div>\n    ')})()};return{init:()=>{let e=window.localStorage.getItem("spaceItCode");"#login"===location.hash&&e&&e.length&&(document.getElementById("textareaCode").value=window.localStorage.getItem("spaceItCode"),window.editor.getDoc().setValue(window.localStorage.getItem("spaceItCode")),window.localStorage.removeItem("spaceItCode"),r())},showDialog:r,closeDialog:()=>{document.getElementById("spaceItModal").style.setProperty("display","none","important")},login:()=>{location.href=`${n}/?redirect_url=${o}%23login`},signup:()=>{location.href=`${n}/sign-up?redirect_url=${o}%23login`},registerSpace:async t=>{let n=(e=>e.length<4?"The name must be at least 4 characters.":e.length>20?"The name cannot be more than 20 characters.":/^[a-z]/.test(e)?/^[a-z\-0-9]*$/.test(e)?void 0:"The name can only contain lower case letters, numbers and dashes.":"The name must start with a lower case letter.")(t);if(n)document.getElementById("spaceit-modal-input-group--validation-error").innerHTML=n;else try{s("We are creating your space...");let n=await fetch(a+`/register/space/${t}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Cookies.get("accessToken")}`},body:JSON.stringify({}),credentials:"include"}).then((e=>e.json()));if(n.error&&"0"===n.error.code&&t)e.data.spaces.push(t),i(),document.getElementById("spaceItSelectedFilename").value=`saved-from-Tryit-${(new Date).toJSON().split("T")[0]}`;else if(void 0===n.error||void 0===n.error.code||"0"!==n.error.code)throw new Error(n.error&&n.error.description?n.error.description:"Something bad happened. Check your code.")}catch(e){console.log(e.message),c(),document.getElementById("spaceItSpaceName").value=t,document.getElementById("spaceit-modal-input-group--validation-error").innerHTML=e.message}},saveCode:async()=>{window.editor&&window.editor.save();let e=document.getElementById("textareaCode").value,t=document.getElementById("spaceItSelectedSpace").options[document.getElementById("spaceItSelectedSpace").selectedIndex].text,n=document.getElementById("spaceItSelectedFilename").value.replace(/\.[^/.]+$/,"");try{s("We are saving your code...");const o=await fetch(a+"/code",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Cookies.get("accessToken")}`},body:JSON.stringify({space:t,name:n,format:"html",code:e}),credentials:"include"}).then((e=>e.json()));if(o.error&&"0"===o.error.code&&o.data.file.rel_path)d(t,o.data.file.rel_path);else if(void 0===o.error||void 0===o.error.code||"0"!==o.error.code)throw new Error(o.error&&o.error.description?o.error.description:"Something bad happened. Check your code.")}catch(e){console.log(e.message),i(),document.getElementById("spaceItSelectedFilename").value=n,document.getElementById("spaceit-modal-input-group-error").innerHTML=e.message}},checkFilename:()=>{document.getElementById("spaceItSelectedFilename").value.length>=1?document.getElementById("spaceItSaveButton").classList.remove("spaceit-modal-button-disabled"):document.getElementById("spaceItSaveButton").classList.add("spaceit-modal-button-disabled")}}})();window.onhashchange=spaceIt.init,spaceIt.init();